<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="IafasGirado">
    <resultMap id="resultado" type="IafasGirado" />

	<select id="TraerDatosFaseDevengado"
		parameterType="ep.mil.pe.iafas.administrativo.girado.model.IafasGirado"
		resultType="ep.mil.pe.iafas.administrativo.girado.model.IafasGirado">
		SELECT cab.VSECUENCIA AS vsecuencia, cab.VANO AS vano, cab.VSECUENCIA_INT AS vsecuenciaInt,  
		cab.VREG_SIAF AS vregSiaf, cab.VFUENTE_FINANCIAMIENTO AS vfuenteFinanciamiento, 
		cab.NTIP_CAM AS ntipCam, cab.NIMP_MON_SOL AS impMonSol, cab.NIMP_MON_EXT AS impMonExt , cab.VTIP_MON AS vtipMon,  
		cab.VGLOSA AS vglosa, dev.CPROVEEDOR_RUC AS vruc , 
		(SELECT pv.CPROVEEDOR_CCI FROM iafas_proveedores pv where pv.CPROVEEDOR_RUC = dev.CPROVEEDOR_RUC ) AS vcci, 
		(SELECT pv.CPROVEEDOR_CUENTA_BANCO FROM iafas_proveedores pv where pv.CPROVEEDOR_RUC = dev.CPROVEEDOR_RUC ) AS cproveedorCuentaBanco,
		dev.VTIP_DOCUMENTO_COM AS vtipDocumentoCom ,dev.vserie_com AS vserieCom,dev.VNRO_DOCUMENTO_COM  AS vnroCom
		FROM iafas_movimiento cab, iafas_devengado dev
		where 
		cab.VANO=dev.VANO AND
		cab.VSECUENCIA=dev.VSECUENCIA AND
		cab.VSECUENCIA_INT=dev.VSECUENCIA_INT AND
		cab.VANO=#{vano}  AND 
		cab.VREG_SIAF=#{vregSiaf} AND 
		cab.VFASE = 'D'
	</select>
    
    <select id="SP_MTO_GIRADO" statementType="CALLABLE" parameterType="ep.mil.pe.iafas.administrativo.girado.model.IafasGirado">
        call SP_MTO_GIRADO(#{vano}, #{vregSiaf},#{vctaCodigo}, #{vcodTipGiro}, #{vglosa}, #{impMonSol}, 
        #{vruc}, #{vusuarioIng},#{mode}, #{ntipCam}, #{vtipMon}, #{vsecuencia}, #{vsecuenciaInt})
    </select>
    
    <select id="obtenerExpedientesGirados"
		parameterType="ep.mil.pe.iafas.administrativo.girado.model.IafasGirado"
		resultType="ep.mil.pe.iafas.administrativo.girado.model.IafasGirado">
		SELECT cab.VSECUENCIA AS vsecuencia, cab.VANO AS vano, cab.VSECUENCIA_INT AS vsecuenciaInt,  
		cab.VREG_SIAF AS vregSiaf, cab.VFUENTE_FINANCIAMIENTO AS vfuenteFinanciamiento, 
		cab.NTIP_CAM AS ntipCam, cab.NIMP_MON_SOL AS impMonSol, cab.NIMP_MON_EXT AS impMonExt , cab.VTIP_MON AS vtipMon,  
		cab.VGLOSA AS vglosa , gir.VNRO_CHE_CAR AS vnroCheCar,
		 CASE cab.VCOD_ESTADO
    	WHEN '2' THEN 'REGISTRADO'
    	ELSE 'ANULADO'  END desEstado
        ##dev.CPROVEEDOR_RUC AS vruc , 
		##(SELECT pv.CPROVEEDOR_CCI FROM iafas_proveedores pv where pv.CPROVEEDOR_RUC = dev.CPROVEEDOR_RUC ) AS vcci, 
		##(SELECT pv.CPROVEEDOR_CUENTA_BANCO FROM iafas_proveedores pv where pv.CPROVEEDOR_RUC = dev.CPROVEEDOR_RUC ) AS cproveedorCuentaBanco
		FROM iafas_movimiento cab, iafas_girado gir
		where 
		cab.VANO=gir.VANO AND
		cab.VSECUENCIA=gir.VSECUENCIA AND
		cab.VSECUENCIA_INT=gir.VSECUENCIA_INT AND
		cab.VANO='2021'  AND 
		cab.VUSUARIO_ING=#{vusuarioIng} AND 
		cab.VFASE = 'G'
	</select>
 
</mapper>